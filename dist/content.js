(()=>{function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}function n(){var e=document.createElement("div");return e.id="helloTextBox",e.style.cssText='\n        padding: 10px;\n        margin: 10px 0;\n        border: 1px solid #333;\n        border-radius: 8px;\n        background-color: #000;\n        color: #71767b;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n        min-height: 20px;\n    ',e.textContent="Write your anonymous comment...",e.contentEditable="true",e.addEventListener("focus",(function(){"Write your anonymous comment..."===this.textContent&&(this.textContent="",this.style.color="#fff")})),e.addEventListener("blur",(function(){""===this.textContent.trim()&&(this.textContent="Write your anonymous comment...",this.style.color="#71767b")})),e}function t(){var e=document.createElement("script");e.src=chrome.runtime.getURL("inject.js"),e.type="text/javascript",(document.head||document.documentElement).appendChild(e)}var o=document.createElement("style");function r(e,n){var t;return function(){for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];clearTimeout(t),t=setTimeout((function(){clearTimeout(t),e.apply(void 0,r)}),n)}}o.textContent="\n    @keyframes shake {\n        0%, 100% { transform: translateX(0); }\n        25% { transform: translateX(-5px); }\n        75% { transform: translateX(5px); }\n    }\n",document.head.appendChild(o);var i=r((function(e){console.log("getComments",e),chrome.runtime.sendMessage({action:"GetTwitterComments",tweetId:e},(function(e){if(e.success){var n=e.data.Messages[0].Data,t=JSON.parse(n);t&&Array.isArray(t)&&document.dispatchEvent(new CustomEvent("COMMENTS_IN_TWITTER",{detail:{success:!0,comments:t}}))}else console.error("Error:",e.error)}))}),1e3);function a(){var e=document.createElement("div");e.className="custom-container",e.style.cssText="\n        background-color: #000;  // 添加黑色背景\n        padding: 16px;\n        border-radius: 16px;\n        margin: 16px 0;\n        border: 1px solid #2f3336;\n    ";var t=n(),o=function(){var e,n=document.createElement("div");return n.style.cssText="\n        display: flex;\n        gap: 10px;\n    ",n.appendChild(((e=document.createElement("button")).id="wallet-connect-button",e.style.cssText='\n        padding: 8px 16px;\n        margin: 10px 0;\n        border: none;\n        border-radius: 20px;\n        background-color: #1DA1F2;\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n        font-weight: bold;\n        cursor: pointer;\n        transition: background-color 0.2s;\n        margin-right: 10px;\n        min-width: 140px;\n    ',window.postMessage({type:"CHECK_WALLET_CONNECTION"},"*"),e.onmouseover=function(){return e.style.backgroundColor="#1991db"},e.onmouseout=function(){return e.style.backgroundColor="#1DA1F2"},e.textContent="Connect Wallet",e.onclick=function(){window.postMessage({type:"CONNECT_ARWEAVE"},"*")},e)),n.appendChild(function(){var e=document.createElement("button");return e.style.cssText='\n        padding: 8px 16px;\n        margin: 10px 0;\n        border: none;\n        border-radius: 20px;\n        background-color: #28a745;\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n        font-weight: bold;\n        cursor: pointer;\n        transition: background-color 0.2s;\n    ',e.textContent="Anonymous comment",e.onmouseover=function(){return e.style.backgroundColor="#218838"},e.onmouseout=function(){return e.style.backgroundColor="#28a745"},e.onclick=function(){var e=document.getElementById("helloTextBox"),n=e?e.textContent:"";if(!n||""===n.trim()||"Write your anonymous comment..."===n)return e.style.animation="shake 0.5s",setTimeout((function(){e.style.animation=""}),500),e.style.border="1px solid #dc3545",void setTimeout((function(){e.style.border="1px solid #333"}),2e3);var t=window.location.href.split("/").pop();window.postMessage({type:"SIGN_TEXT",text:n.trim(),tweetId:t,parent:""},"*"),e.textContent="Write your anonymous comment...",e.style.color="#71767b"},e}()),n}();e.appendChild(t),e.appendChild(o);var r=window.location.href.split("/").pop();return i(r),e}function c(){window.addEventListener("message",(function(e){"CONNECT_ARWEAVE"===e.data.type&&window.postMessage({type:"TRIGGER_ARCONNECT"},"*")})),window.addEventListener("message",(function(e){"SEND_HELLO"===e.data.type&&window.postMessage({type:"SEND_HELLO_AO"},"*")})),document.addEventListener("ARCONNECT_SUCCESS",(function(e){var n=e.detail.address,t="".concat(n.slice(0,6),"...").concat(n.slice(-4)),o=document.getElementById("wallet-connect-button");o&&(o.textContent=t,o.style.backgroundColor="#28a745",o.onmouseover=function(){return o.style.backgroundColor="#218838"},o.onmouseout=function(){return o.style.backgroundColor="#28a745"})})),document.addEventListener("ARCONNECT_ERROR",(function(e){alert("Connection failed: ".concat(e.detail.error))})),document.addEventListener("GET_SIGNER",(function(e){chrome.runtime.sendMessage({action:"CreateTwitterComments",signedData:e.detail.signedData},(function(n){console.log(n),n.success?i(e.detail.tweetId):console.error("Error:",n.error)}))})),document.addEventListener("COMMENTS_IN_TWITTER",(function(n){console.log("Received comments event");var t=n.detail,o=(t.success,t.comments),r=document.querySelector(".custom-container");if(r){var i=r.querySelector(".comment-section");i&&i.remove();var a=document.createElement("div");a.className="comment-section",a.style.cssText="\n                margin-top: 16px;\n            ";var c=function(n){var t,o=(t=n,function(n){if(Array.isArray(n))return e(n)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(n,t){if(n){if("string"==typeof n)return e(n,t);var o={}.toString.call(n).slice(8,-1);return"Object"===o&&n.constructor&&(o=n.constructor.name),"Map"===o||"Set"===o?Array.from(n):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(n,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort((function(e,n){return n.time-e.time})),r=new Map,i=[];return o.forEach((function(e){e.replies=[],e.isExpanded=!1,r.set(e.textid,e)})),o.forEach((function(e){if("comment"===e.parent)i.push(e);else{var n=r.get(e.parent);n&&n.replies.push(e)}})),i.forEach((function(e){e.replies.length>0&&e.replies.sort((function(e,n){return n.time-e.time}))})),i}(o);p(c,a),r.appendChild(a)}})),document.addEventListener("WALLET_STATUS",(function(e){console.log("WALLET_STATUS",e.detail);var n=e.detail,t=n.isConnected,o=n.address,r=document.getElementById("wallet-connect-button");if(r&&t&&o){var i="".concat(o.slice(0,6),"...").concat(o.slice(-4));r.textContent=i,r.style.backgroundColor="#28a745",r.onmouseover=function(){return r.style.backgroundColor="#218838"},r.onmouseout=function(){return r.style.backgroundColor="#28a745"}}}))}function s(){var e=document.querySelector('[data-testid="inline_reply_offscreen"]');if(e&&e.parentNode){if(!document.querySelector(".custom-container"))try{var n=a();e.parentNode.insertBefore(n,e.nextSibling)}catch(e){console.error("Error inserting container:",e),setTimeout((function(){var e=document.querySelector('[data-testid="inline_reply_offscreen"]');if(e&&e.parentNode&&!document.querySelector(".custom-container")){var n=a();e.parentNode.insertBefore(n,e.nextSibling)}}),500)}}else setTimeout((function(){var e=document.querySelector('[data-testid="inline_reply_offscreen"]');if(e&&e.parentNode&&!document.querySelector(".custom-container")){var n=a();e.parentNode.insertBefore(n,e.nextSibling)}}),500)}function l(){var e=location.href;new MutationObserver((function(){var n=location.href;if(n!==e){e=n,console.log("URL changed to:",n);var t=document.querySelector(".custom-container");t&&t.remove(),document.querySelector('[data-testid="inline_reply_offscreen"]')&&s()}})).observe(document.body,{subtree:!0,childList:!0})}function d(){var e=new MutationObserver(r((function(e){var n=document.querySelector('[data-testid="inline_reply_offscreen"]');if(n&&n.parentNode&&!document.querySelector(".custom-container"))try{s()}catch(e){console.error("Error in DOM observer:",e)}}),500));return e.observe(document.body,{childList:!0,subtree:!0,attributes:!0}),e}function u(){chrome.storage.local.get(["extensionEnabled"],(function(e){!1!==e.extensionEnabled&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){t(),c(),l(),d(),setTimeout((function(){var e=document.querySelector('[data-testid="inline_reply_offscreen"]');e&&e.parentNode&&s()}),500)})):(t(),c(),l(),d(),setTimeout((function(){var e=document.querySelector('[data-testid="inline_reply_offscreen"]');e&&e.parentNode&&s()}),500)))}))}function p(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.forEach((function(e){var r=function(e){var t=document.createElement("div");t.className="comment-item",t.style.cssText="\n        padding: 12px;\n        border-bottom: 1px solid #333;\n        margin: 8px 0;\n    ";var o=document.createElement("div");o.style.cssText="\n        display: flex;\n        gap: 12px;\n    ";var r=document.createElement("div");r.style.cssText="\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background-color: #1c1c1c;\n        flex-shrink: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        overflow: hidden;\n    ",r.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" \n                  fill="#4A4A4A"/>\n        </svg>\n    ';var i=document.createElement("div");i.style.cssText="\n        flex-grow: 1;\n    ";var a=document.createElement("div");a.style.cssText="\n        display: flex;\n        align-items: center;\n        margin-bottom: 4px;\n    ";var c,s=document.createElement("span");s.style.cssText="\n        font-weight: bold;\n        color: #fff;\n    ",s.textContent=(c=e.owner)&&"Anonymous"!==c?c.length<=10?c:"".concat(c.slice(0,6),"...").concat(c.slice(-4)):"Anonymous";var l=document.createElement("span");l.style.cssText="\n        color: #71767b;\n        font-size: 14px;\n        margin-left: 8px;\n    ",l.textContent=function(e){if(!e)return"Just now";var n=new Date(e);if(isNaN(n.getTime()))return"Invalid date";var t=new Date;if(Math.floor((t-n)/6e4)<60)return"Just now";var o=function(e){return String(e).padStart(2,"0")},r=n.getFullYear(),i=o(n.getMonth()+1),a=o(n.getDate()),c=o(n.getHours()),s=o(n.getMinutes());return"".concat(r,"/").concat(i,"/").concat(a," ").concat(c,":").concat(s)}(e.time),a.appendChild(s),a.appendChild(l);var d=document.createElement("div");d.style.cssText="\n        color: #fff;\n        margin-bottom: 8px;\n    ",d.textContent=e.message;var u=document.createElement("div");u.style.cssText="\n        display: flex;\n        gap: 12px;\n        align-items: center;\n    ";var p=document.createElement("button");if(p.style.cssText="\n        background: none;\n        border: none;\n        color: #71767b;\n        font-size: 14px;\n        cursor: pointer;\n        padding: 4px 8px;\n        border-radius: 4px;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n    ",p.innerHTML='\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.96-1.607 5.68-4.196 7.11l-8.054 4.46v-3.69h-.067c-4.49.1-8.183-3.51-8.183-8.01zm8.005-6c-3.317 0-6.005 2.69-6.005 6 0 3.37 2.77 6.08 6.138 6.01l.351-.01h1.761v2.3l5.087-2.81c1.951-1.08 3.163-3.13 3.163-5.36 0-3.39-2.744-6.13-6.129-6.13H9.756z"/>\n        </svg>\n        Reply\n    ',e.replies&&e.replies.length>0){var m=document.createElement("button");m.style.cssText="\n            background: none;\n            border: none;\n            color: #1DA1F2;\n            font-size: 14px;\n            cursor: pointer;\n            padding: 4px 8px;\n            border-radius: 4px;\n        ",m.textContent="Show ".concat(e.replies.length," ").concat(1===e.replies.length?"reply":"replies"),m.onclick=function(n){n.stopPropagation(),e.isExpanded=!e.isExpanded,t.parentNode.querySelectorAll('[data-parent-id="'.concat(e.textid,'"]')).forEach((function(n){n.style.display=e.isExpanded?"block":"none"})),m.textContent=e.isExpanded?"Hide ".concat(e.replies.length," ").concat(1===e.replies.length?"reply":"replies"):"Show ".concat(e.replies.length," ").concat(1===e.replies.length?"reply":"replies")},u.appendChild(m)}u.appendChild(p);var f=document.createElement("div");f.style.cssText="\n        margin-top: 8px;\n        display: none;\n    ";var y=n();y.style.marginTop="8px";var g=document.createElement("button");if(g.style.cssText="\n        padding: 6px 16px;\n        margin: 8px 0;\n        border: none;\n        border-radius: 20px;\n        background-color: #1DA1F2;\n        color: white;\n        font-weight: bold;\n        cursor: pointer;\n    ",g.textContent="Reply",f.appendChild(y),f.appendChild(g),u.onclick=function(){f.style.display="none"===f.style.display?"block":"none"},g.onclick=function(){var n=y.textContent;if(n&&"Write your anonymous comment..."!==n){var t=window.location.href.split("/").pop();window.postMessage({type:"SIGN_TEXT",text:n,tweetId:t,parent:e.textid},"*"),y.textContent="Write your anonymous comment...",f.style.display="none"}},e.replies&&e.replies.length>0){var x=document.createElement("span");x.style.cssText="\n            color: #71767b;\n            font-size: 13px;\n            margin-left: 4px;\n        ",x.textContent="".concat(e.replies.length," ").concat(1===e.replies.length?"reply":"replies"),u.appendChild(x)}return i.appendChild(a),i.appendChild(d),i.appendChild(u),i.appendChild(f),o.appendChild(r),o.appendChild(i),t.appendChild(o),t}(e);o>0&&(r.dataset.parentId=e.parent,r.style.marginLeft="".concat(20*o,"px"),r.style.borderLeft="2px solid #333",r.style.paddingLeft="20px",r.style.display="none"),t.appendChild(r),e.replies&&e.replies.length>0&&p(e.replies,t,o+1)}))}chrome.runtime.onMessage.addListener((function(e,n,t){if("EXTENSION_STATE_CHANGED"===e.type){var o=e.enabled,r=document.querySelector(".custom-container");if(r)if(o)r.style.display="block",u();else{r.style.display="none";var i=document.querySelector('script[src*="inject.js"]');i&&i.remove()}else o&&u()}})),u(),chrome.runtime.onMessage.addListener((function(e,n,t){if("EXTENSION_STATE_CHANGED"===e.type){var o=e.enabled,r=document.querySelector(".custom-container");r&&(r.style.display=o?"block":"none")}})),chrome.storage.local.get(["extensionEnabled"],(function(e){if(!1===e.extensionEnabled){var n=document.querySelector(".custom-container");n&&(n.style.display="none")}}))})();